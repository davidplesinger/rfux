<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acer Aukce a Burza</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        /* --- ACER BRAND STYLES --- */
        body {
            font-family: 'Trebuchet MS', sans-serif;
            background-color: #f4f4f4;
            color: #333;
        }

        .header-acer {
            background-color: #80C343; /* Acer Green */
            color: white;
            padding: 30px 0;
            margin-bottom: 40px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header-acer h1 {
            font-weight: bold;
            margin: 0;
        }

        .card {
            border: none;
            border-radius: 12px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            background: white;
            height: 100%;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
        }

        .card-img-top {
            height: 220px;
            object-fit: contain;
            padding: 20px;
            background-color: #ffffff;
            border-bottom: 1px solid #f0f0f0;
        }

        .card-body {
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .product-title {
            font-size: 1.15rem;
            font-weight: bold;
            margin-bottom: 8px;
            color: #000;
        }

        .product-desc {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 15px;
            flex-grow: 1; /* Vyplní zbývající místo a zarovná ceny dolů */
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
        }

        .price-tag {
            font-size: 1.6rem;
            color: #80C343; /* Acer Green */
            font-weight: bold;
            margin-bottom: 2px;
        }

        .price-original {
            text-decoration: line-through;
            color: #898988; /* Tintree Grey */
            font-size: 0.95rem;
        }

        .status-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
            text-transform: uppercase;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .status-active {
            background-color: #80C343;
            color: white;
        }

        .status-sold {
            background-color: #898988;
            color: white;
        }

        .btn-acer {
            background-color: #80C343;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
            width: 100%;
            font-weight: bold;
            margin-top: 15px;
            text-decoration: none;
            display: block;
            text-align: center;
            transition: background-color 0.2s;
        }

        .btn-acer:hover {
            background-color: #6DA838;
            color: white;
        }

        .btn-disabled {
            background-color: #e0e0e0;
            color: #898988;
            cursor: not-allowed;
            pointer-events: none;
            margin-top: 15px;
        }
    </style>
</head>
<body>

    <div class="header-acer text-center">
        <h1>Burza techniky Acer</h1>
        <p class="mt-2 mb-0">Aktuální nabídka zařízení pro zaměstnance a partnery</p>
    </div>

    <div class="container mb-5">
        <div id="product-grid" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 row-cols-xl-4 g-4">
            <div class="text-center w-100 mt-5" id="loading-spinner">
                <div class="spinner-border text-success" role="status" style="width: 3rem; height: 3rem;"></div>
                <h5 class="mt-3">Načítám aktuální data katalogu...</h5>
            </div>
        </div>
    </div>

    <script>
        // --- NASTAVENÍ ---
        const GOOGLE_SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSfOJzHS5TteB4jDdVfMMdhFcVDGK1Oqh7ad1A6bXLhdPvuju1mrldVFaie7uyt2pVO1_s2RHCrmU3v/pub?gid=0&single=true&output=csv"; 
        
        // ZDE DOPLŇTE URL VAŠEHO PLUMSAIL FORMULÁŘE (bez otazníku a parametrů na konci)
        const PLUMSAIL_FORM_URL = "https://forms.plumsail.com/VAŠE_ID_FORMULÁŘE";

        // --- NAČTENÍ DAT ---
        async function loadCatalog() {
            try {
                // Přidání časového razítka proti cachování prohlížečem
                const cacheBuster = new Date().getTime();
                const response = await fetch(`${GOOGLE_SHEET_CSV_URL}&t=${cacheBuster}`);
                
                if (!response.ok) throw new Error("Chyba při stahování dat");
                
                const data = await response.text();
                const products = parseCSV(data);
                
                renderProducts(products);
            } catch (error) {
                console.error("Chyba:", error);
                document.getElementById('product-grid').innerHTML = `
                    <div class="col-12 text-center mt-5">
                        <div class="alert alert-danger">
                            Nepodařilo se načíst katalog. Zkontrolujte připojení k internetu nebo nastavení sdílení tabulky.
                        </div>
                    </div>`;
            }
        }

        // --- PARSOVÁNÍ CSV ---
        function parseCSV(csvText) {
            const rows = csvText.split(/\r?\n/);
            const headers = rows[0].split(',').map(h => h.trim().replace(/^"|"$/g, ''));
            const data = [];

            for (let i = 1; i < rows.length; i++) {
                if (!rows[i].trim()) continue; // Přeskočit prázdné řádky
                
                // Rozdělení podle čárky, ale s ignorováním čárek uvnitř uvozovek
                const rowRegex = /(".*?"|[^",\s]+)(?=\s*,|\s*$)/g;
                const match = rows[i].match(rowRegex);
                
                if (match) {
                    const rowData = {};
                    headers.forEach((header, index) => {
                        let value = match[index] ? match[index].replace(/^"|"$/g, '').trim() : '';
                        rowData[header] = value;
                    });
                    data.push(rowData);
                }
            }
            return data;
        }

        // --- VYKRESLENÍ PRODUKTŮ ---
        function renderProducts(products) {
            const grid = document.getElementById('product-grid');
            grid.innerHTML = ""; // Odstranit spinner
            
            if (products.length === 0) {
                grid.innerHTML = `<div class="col-12 text-center mt-5"><h4>Katalog je momentálně prázdný.</h4></div>`;
                return;
            }

            products.forEach(p => {
                // Extrakce dat z CSV sloupců
                const title = p['Title'] || 'Neznámý produkt';
                const popis = p['Popis'] || '';
                const priceStart = parseFloat(p['StartPrice']) || 0;
                const priceCurrent = parseFloat(p['CurrentPrice']) || 0;
                let image = p['ImageURL'] || '';
                const id = p['ID'] || '';
                const status = p['Status'] || 'Aktivní';
                
                // Ošetření prázdného obrázku
                if (image === '' || image.toLowerCase() === 'null') {
                    image = 'https://via.placeholder.com/300?text=Zat%C3%ADm+bez+fotky';
                }

                // Výpočet slevy
                let discountText = "";
                if (priceStart > priceCurrent && priceStart > 0) {
                    const discount = Math.round(((priceStart - priceCurrent) / priceStart) * 100);
                    discountText = `<small class="text-success fw-bold">Sleva ${discount} %</small>`;
                }

                // Status štítek a tlačítko
                const isSold = status.toLowerCase().includes('prod') || status.toLowerCase().includes('sold');
                const badgeClass = isSold ? 'status-sold' : 'status-active';
                const badgeText = isSold ? 'PRODÁNO' : 'AKTIVNÍ';
                const btnClass = isSold ? 'btn-disabled' : 'btn-acer';
                const btnText = isSold ? 'Již prodáno' : 'Zadat nabídku';
                
                // Generování URL do Plumsail formuláře s parametry
                let formLink = "#";
                if (!isSold) {
                    formLink = `${PLUMSAIL_FORM_URL}?produkt=${encodeURIComponent(title)}&cena=${priceCurrent}&id=${id}`;
                }

                // Tvorba HTML karty
                const cardHTML = `
                <div class="col">
                    <div class="card">
                        <span class="status-badge ${badgeClass}">${badgeText}</span>
                        <img src="${image}" class="card-img-top" alt="${title}" onerror="this.src='https://via.placeholder.com/300?text=Chyba+obr%C3%A1zku'">
                        <div class="card-body">
                            <div class="product-title" title="${title}">${title}</div>
                            <div class="product-desc" title="${popis}">${popis}</div>
                            
                            <div class="prices mt-auto">
                                <div class="price-original">Běžná cena: ${priceStart.toLocaleString('cs-CZ')} Kč</div>
                                <div class="price-tag">${priceCurrent.toLocaleString('cs-CZ')} Kč</div>
                                ${discountText}
                            </div>

                            <a href="${formLink}" class="btn ${btnClass}" target="_blank">${btnText}</a>
                        </div>
                    </div>
                </div>
                `;

                grid.innerHTML += cardHTML;
            });
        }

        // Spuštění po načtení stránky
        document.addEventListener('DOMContentLoaded', loadCatalog);

    </script>
</body>
</html>